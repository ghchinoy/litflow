<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Interactivity - LitFlow</title>
    <style>
      body, html {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-family: sans-serif;
      }
      #app {
        width: 100vw;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      .toolbar {
        padding: 10px;
        background: #fff;
        border-bottom: 1px solid #ccc;
        display: flex;
        gap: 10px;
        z-index: 20;
      }
      .flow-container {
        flex-grow: 1;
        position: relative;
      }
      .back-link {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: #333;
        font-size: 14px;
        font-weight: bold;
        padding: 0 10px;
        border-right: 1px solid #ccc;
        margin-right: 5px;
      }
      button {
        padding: 8px 12px;
        cursor: pointer;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
      }
      button:hover {
        background: #0056b3;
      }
      button.secondary {
        background: #6c757d;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="toolbar">
        <a href="/examples/index.html" class="back-link">‚Üê Back</a>
        <button id="add-node">Add Random Node</button>
        <button id="remove-node" class="secondary">Remove Last Node</button>
        <button id="remove-selected" class="secondary">Remove Selected</button>
        <button id="add-edge">Connect Random Nodes</button>
        <button id="clear-edges" class="secondary">Clear Edges</button>
      </div>
      <div class="flow-container">
        <lit-flow id="my-flow"></lit-flow>
      </div>
    </div>
    <script type="module">
      import '../../src/index.ts';
      const flow = document.getElementById('my-flow');
      
      let nodeId = 1;
      
      const initialNodes = [
        { id: '0', position: { x: 250, y: 150 }, data: { label: 'Node 0' } }
      ];
      
      flow.nodes = initialNodes;
      flow.edges = [];

      document.getElementById('add-node').onclick = () => {
        const id = `${nodeId++}`;
        const newNode = {
          id,
          position: { x: Math.random() * 400, y: Math.random() * 400 },
          data: { label: `Node ${id}` }
        };
        flow.nodes = [...flow.nodes, newNode];
      };

      document.getElementById('remove-node').onclick = () => {
        if (flow.nodes.length > 0) {
          flow.nodes = flow.nodes.slice(0, -1);
        }
      };

      document.getElementById('remove-selected').onclick = () => {
        const selectedIds = new Set(flow.nodes.filter(n => n.selected).map(n => n.id));
        if (selectedIds.size === 0) return;

        flow.nodes = flow.nodes.filter(n => !selectedIds.has(n.id));
        flow.edges = flow.edges.filter(e => !selectedIds.has(e.source) && !selectedIds.has(e.target));
      };

      document.getElementById('add-edge').onclick = () => {
        if (flow.nodes.length < 2) return;
        
        const sourceIdx = Math.floor(Math.random() * flow.nodes.length);
        let targetIdx = Math.floor(Math.random() * flow.nodes.length);
        while (targetIdx === sourceIdx) {
          targetIdx = Math.floor(Math.random() * flow.nodes.length);
        }
        
        const source = flow.nodes[sourceIdx].id;
        const target = flow.nodes[targetIdx].id;
        const id = `e${source}-${target}`;
        
        // Avoid duplicates
        if (flow.edges.find(e => e.id === id)) return;

        flow.edges = [...flow.edges, { id, source, target }];
      };

      document.getElementById('clear-edges').onclick = () => {
        flow.edges = [];
      };
    </script>
  </body>
</html>
